+++
title = "Meteor(16):移动应用"
description = "How to build mobile apps using Meteor's Cordova integration."
tags = [
    "JavaScript",
    "NodeJs",
    "Web application",
    "Mobile application",
    "Platform",
    "MongoDB",
]
date = "2017-11-23"
categories = [
    "Development",
    "nodejs",
]
thumbnail = "images/meteor-guide/Meteor-cordova.png"
+++

如何使用Meteor的Cordova集成来构建移动应用程序。

<!--more-->

阅读本指南后, 您将知道:

1.  cordova是什么, 以及如何与它集成, 以建立一个单一的基本代码的移动应用程序
2.  如何设置本地计算机以进行移动开发
3.  如何在移动设备或模拟器/仿真程序上运行和调试应用程序
4.  热代码的推动, 使您可以更新您的移动应用程序的代码, 而无需重新安装应用程序在您的设备或提交一个新的版本到商店
5.  如何使用cordova插件利用本机设备功能
6.  如何从应用程序访问本地文件和远程资源
7.  您可以做些什么来为您的应用程序创建一个好的移动用户体验
8.  如何配置应用程序以使用自己的应用程序图标、启动屏幕和设置其他首选项
9.  如何构建您的项目并将您的移动应用程序提交到商店

##  Meteor与Cordova集成

Meteor集成了Cordova, 一个著名的 Apache 开源项目, 从相同的代码库中构建移动应用程序, 您可以使用它来创建常规的 web 应用程序。随着Cordova集成在Meteor, 您可以使您现有的应用程序, 通过几个简单的命令运行在 iOS 或 Android 设备。

Cordova应用程序是一个使用 HTML、CSS 和 JavaScript 编写的 web 应用程序, 但它运行在一个内嵌在本地应用程序中的 web 视图中, 而不是在 stand-alone 的移动浏览器中。
将您的 web 应用程序打包为Cordova应用程序的一个重要好处是, 您的所有资源都与该应用程序捆绑在一起。这可以确保您的应用程序比在远程服务器上运行的 web 应用程序加载的速度更快, 这会使用户对低速移动连接产生巨大的影响。
Cordova集成在Meteor的另一个特点是支持代码热推, 它允许您更新您的用户的设备的应用程序, 而无需通过通常的应用程序商店审查过程。

Cordova还通过插件体系结构打开了对某些本地设备功能的访问。插件允许您使用通常不能用于 web 应用程序的功能, 如访问设备摄像机或本地文件系统、与条码或 NFC 阅读器交互等。

因为Cordova应用程序是一个 web 应用程序, 这意味着您可以使用标准的 web 元素来创建用户界面, 而不是依赖于特定于平台的本机 UI 组件。创建一个好的移动用户体验本身就是一门艺术, 但幸运的是, 各种框架和库的可用性提供了帮助。


>   什么是PhoneGap呢？
>   你可能听说过 PhoneGap, 并想知道它与Cordova有什么关系。PhoneGap 是 Adobe 自2011年以来使用的产品名称, 当时他们收购了一家名为 Nitobi 的公司, 最初的创始人是现在的Cordova项目创始人。
当 Adobe 在2012年将代码捐赠给 Apache 以确保更开放的治理模型时, 开源项目被更名为科尔多瓦。PhoneGap 现在是Cordova的发布之一, 与其他发布如Ionic, Telerik, Monaca, 或英特尔 XDK。
这些发布主要区别是它们与云服务的集成和工具不同, 但它们共享底层平台和插件。流星也可以被认为是Cordova的发布。

### 它是如何工作的？

使用Meteor, 没有必要安装Cordova, 或直接使用Cordova命令。Cordova项目的创建发生在Meteor运行和生成命令的同时, 项目本身被认为是一个生成工件 (存储在```.meteor/local/cordova-build```-在您的应用程序目录中), 可以随时删除和重新创建。
而不是让您修改Cordova的```config.xml```文件, 流星在您的应用程序目录的根中读取一个```mobile-config.js```文件, 并使用指定的设置来配置生成的项目。

Cordova应用程序不通过网络加载 web 内容, 而是依赖于本地存储的 HTML、CSS、JavaScript 代码和其他资源。虽然Cordova默认使用```file://URLs```加载应用程序, Meteor包括一个集成的设备的文件服务机制, 以支持捆绑的初始资源，和通过代码热推增量更新您的应用程序。
这意味着您的应用程序将从 ```http://localhost: <port>```获得服务, 这也有好处, web 视图认为它是一个安全的来源, 并不会阻止任何敏感的功能。

>   您的应用程序将从哪个端口获得服务？
>   虽然Meteor在 Android 上使用一个内置的请求拦截机制, 但在iOS上要支持 WKWebView 需要运行一个真正的嵌入式 web 服务器。这意味着本地 web 服务器需要绑定一个固定的端口, 我们不能简单地使用固定端口, 因为这可能导致在同一设备上运行多个 "流星科尔多瓦" 应用程序时发生冲突。
最简单的解决方案似乎是使用随机端口, 但这有一个严重的缺点: 如果每次运行应用程序时端口都发生变化, 则依赖于源的 web 功能 (如缓存、localStorage、IndexedDB) 不会在每次运行之间得到保持, 而且也不能够指定稳定的 OAuth 重定向 URL。因此, 我们现在选择一个预定范围 (12000-13000)的端口,
该计算基于 appId, 一个唯一的标识符, 它是每个Meteor项目的一部分。这确保了相同的应用程序将始终使用相同的端口, 它尽可能避免与其他应用程序尽发生冲突。(仍然有一个理论上可能的端口中突。在这种情况下启动本地服务器将失败。)

###  运行时环境

**iOS**

**Android**

### 添加Cordova平台

## 安装的先决条件

### iOS

**通过App Store安装XCode**

**接受许可协议**

### Android

**安装JDK**

**安装Android Studio**

**使用Ubuntu Make**

**设置```ANDROID_HOME```并将工具目录添加到```PATH```中**

**可选: 创建一个 Android 虚拟设备 (AVD) 以便在仿真器上运行应用程序**

##  在设备上进行开发

**连接服务器**

### 在iOS上

### 在Android上

##  日志记不和调试

### 日志的不同类型

### 在iOS上用Safari进行调试

### 在Android上用Chrome进行调试

##  在移动应用上进行代码热推

### 生产环境

### 控制兼容性版本

### 配置服务器

### 从错误版本恢复

##  通过Cordova插件访问本机功能

### 安装插件

**设置插件参数**

**从git安装插件**

**从本地文件系统安装插件**

**直接删除安装的插件**

### 使用插件

### 在 JavaScript 代码中检测Cordova

## 访问本地文件和远程资源

### 本地文件

### 域名白名单

### 内容安全策略 (CSP)

### 跨源资源共享 (CORS)

### 系统权限

##  配置您的应用程序

### Metadata

### Preferences

### 应用程序图标和启动屏幕

### 高级自定义构建

##  部署到生产环境

### 为生产环境构建

### iOS应用商店

### Android应用商店

**使用Crosswalk提交应用程序到应用商店**


